# =========================
# ä»£ç†è®¢é˜…
# =========================
proxy-providers:
  # æœºåœºåç§°
  sub1:
    # æœºåœºè®¢é˜…åœ°å€
    url: http://xxxx/sub1
    type: http
    path: ./providers/sub1.yaml
    interval: 86400
    # è®¢é˜…èŠ‚ç‚¹çš„ User-Agent
    header:
      User-Agent:
        - passwall
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      lazy: true
    proxy: ç›´è¿
    exclude-filter: "(?i)(è¿‡æœŸæ—¶é—´)|(å‰©ä½™æµé‡)|(TGç¾¤)|(å®˜ç½‘)"
  sub2:
    url: http://xxxx/sub2
    type: http
    path: ./providers/sub2.yaml
    interval: 86400
    health-check:
      enable: true
      url: https://www.gstatic.com/generate_204
      interval: 300
      lazy: true
    proxy: ç›´è¿
    exclude-filter: "(?i)(è¿‡æœŸæ—¶é—´)|(å‰©ä½™æµé‡)|(TGç¾¤)|(å®˜ç½‘)"

# =========================
# åŸºç¡€é…ç½®
# =========================
mixed-port: 7890
allow-lan: true
# Clash è·¯ç”±å·¥ä½œæ¨¡å¼
# rule: åŸºäºè§„åˆ™çš„æ•°æ®åŒ…è·¯ç”±
# global: æ‰€æœ‰æ•°æ®åŒ…å°†è¢«è½¬å‘åˆ°å•ä¸ªèŠ‚ç‚¹
# direct: ç›´æ¥å°†æ•°æ®åŒ…è½¬å‘åˆ°äº’è”ç½‘
mode: rule
ipv6: false
log-level: warning
tcp-concurrent: true
find-process-mode: off # å…³é—­è¿›ç¨‹æŸ¥æ‰¾
global-client-fingerprint: chrome
# global-ua: clash.meta/1.19.19

# =========================
# å¤–éƒ¨æ§åˆ¶å™¨é…ç½®
# =========================
external-controller: 127.0.0.1:9090
secret: "2v6Wc@WSjVKQ!$fA"

# =========================
# TUN å¼ºåˆ¶æ¥ç®¡æ¨¡å¼
# =========================
tun:
  enable: false
  stack: gvisor
  device: utun
  endpoint-independent-nat: true
  auto-route: false
  auto-detect-interface: false
  auto-redirect: false
  strict-route: false
  dns-hijack:
    - any:53

# =========================
# DNS æé™é˜²æ³„éœ²é…ç½®
# =========================
dns:
  enable: true
  prefer-h3: false
  ipv6: false
  use-hosts: true
  use-system-hosts: false

  listen: 127.0.0.1:7874
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  fake-ip-ttl: 300

  fake-ip-filter:
    # å±€åŸŸç½‘åŸŸå
    - "*.lan"
    - "*.local"
    - "*.localdomain"
    - "*.home.arpa"
    # QQ æœ¬åœ°è®¤è¯
    - "localhost.ptlogin2.qq.com"
    - "localhost.sec.qq.com"
    # STUN
    - "stun.*"
    # NTP / æ—¶é—´åŒæ­¥
    - "time.*"
    - "*.ntp.org"
    - "*.ntp.org.cn"
    - "*.time.edu.cn"
    # Microsoft è¿é€šæ€§æ£€æµ‹
    - "*.msftconnecttest.com"
    - "*.msftncsi.com"
    # ä½ çš„è‡ªå®šä¹‰åŸŸ
    - "*.glacier.top"
    # æœºåœº
    - "*.ali66mysql.com"
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  fallback:
    - https://1.1.1.1/dns-query
    - https://8.8.8.8/dns-query
    - tls://1.1.1.1
    - tls://8.8.8.8
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
      - 0.0.0.0/32

  respect-rules: true
  proxy-server-nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query
  nameserver-policy:
    "geosite:cn":
      - https://dns.alidns.com/dns-query
      - https://doh.pub/dns-query
    "geosite:geolocation-!cn":
      - https://1.1.1.1/dns-query
      - https://8.8.8.8/dns-query

  cache-algorithm: arc
  cache-max-size: 8192

# =========================
# ç«¯å£ç›‘å¬é…ç½®ï¼ˆå¯é€‰ï¼‰
# =========================
# listeners:
#   - {name: mixed0, type: mixed, port: 42000, proxy: å°æ¹¾-æ•…è½¬}
#   - {name: mixed1, type: mixed, port: 42001, proxy: ç¾å›½-æ•…è½¬}

# =========================
# é…ç½®æ–‡ä»¶ç®¡ç†
# =========================
profile:
  store-selected: true
  store-fake-ip: true

proxies:
  - name: ç›´è¿
    type: direct
  - name: æ‹’ç»
    type: reject

  # # é“¾å¼ä»£ç†
  # - name: é“¾å¼å‡ºå£1
  #   type: socks5
  #   server:
  #   port:
  #   username:
  #   password:
  #   dialer-proxy: é¦™æ¸¯-æ•…è½¬

# =========================
# ä»£ç†ç»„é…ç½®
# =========================
# - include-all-proxies: true  åŒ…å«æ‰‹åŠ¨èŠ‚ç‚¹
# - use: [è®¢é˜…1, è®¢é˜…2, è®¢é˜…3, è®¢é˜…4, è®¢é˜…5] åŒ…å«è®¢é˜…èŠ‚ç‚¹
# - domain-strategy: ipv4-only å¼ºåˆ¶ä»…ä½¿ç”¨ IPv4
# =========================

# é»˜è®¤ä»£ç†ç»„é…ç½®
default: &default
  type: select
  proxies:
    - ç›´è¿
    # - æ‰€æœ‰-è‡ªåŠ¨
    - æ‰€æœ‰-æ‰‹åŠ¨
    - é¦™æ¸¯-æ•…è½¬
    - å°æ¹¾-æ•…è½¬
    - æ–°åŠ å¡-æ•…è½¬
    - ç¾å›½-æ•…è½¬
    # - é“¾å¼å‡ºå£1
    - æ‹’ç»

proxy-groups:
  - name: æ‰€æœ‰-æ‰‹åŠ¨
    type: select
    include-all: true
    filter: ^((?!(ç›´è¿|æ‹’ç»)).)*$

  # - name: æ‰€æœ‰-è‡ªåŠ¨
  #   type: url-test
  #   include-all: true
  #   tolerance: 50
  #   # url: http://www.gstatic.com/generate_204 # é»˜è®¤æµ‹é€Ÿurl
  #   interval: 600
  #   filter: ^((?!(ç›´è¿|æ‹’ç»)).)*$
  #   lazy: false

  # ä¸šåŠ¡åˆ†æµç»„
  - name: ğŸ  ç§æœ‰ç½‘ç»œ
    <<: *default
  - name: ğŸ”’ å›½å†…æœåŠ¡
    <<: *default
  - name: ğŸ’¬ AI æœåŠ¡
    <<: *default
  - name: ğŸ¬ æµåª’ä½“
    <<: *default
  - name: ğŸ¬ TikTok
    type: select
    proxies:
      # - é“¾å¼å‡ºå£1
      # - TikTok-è‡ªåŠ¨
      - æ‰€æœ‰-æ‰‹åŠ¨
      - å°æ¹¾-æ•…è½¬
  - name: ğŸ® æ¸¸æˆå¹³å°
    <<: *default
  - name: ğŸŒ éä¸­å›½
    <<: *default
  - name: ğŸ§¬ TEST
    <<: *default
  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    <<: *default

  - name: é¦™æ¸¯-æ•…è½¬
    type: fallback
    interval: 300
    lazy: false
    proxies:
      - é¦™æ¸¯-æ‰‹åŠ¨
      - é¦™æ¸¯-è‡ªåŠ¨

  - name: é¦™æ¸¯-æ‰‹åŠ¨
    type: select
    include-all: true
    filter: (?=.*(å¹¿æ¸¯|é¦™æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°|HongKong)).*$

  - name: é¦™æ¸¯-è‡ªåŠ¨
    type: url-test
    include-all: true
    tolerance: 50
    interval: 600
    filter: (?=.*(å¹¿æ¸¯|é¦™æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°|HongKong)).*$

  - name: å°æ¹¾-æ•…è½¬
    type: fallback
    interval: 300
    lazy: false
    proxies:
      - å°æ¹¾-æ‰‹åŠ¨
      - å°æ¹¾-è‡ªåŠ¨

  - name: å°æ¹¾-æ‰‹åŠ¨
    type: select
    include-all: true
    filter: (?=.*(å¹¿å°|å°æ¹¾|å°ç£|TW|Tai Wan|ğŸ‡¹ğŸ‡¼|ğŸ‡¨ğŸ‡³|TaiWan|Taiwan)).*$

  - name: å°æ¹¾-è‡ªåŠ¨
    type: url-test
    include-all: true
    tolerance: 50
    interval: 600
    filter: (?=.*(å¹¿å°|å°æ¹¾|å°ç£|TW|Tai Wan|ğŸ‡¹ğŸ‡¼|ğŸ‡¨ğŸ‡³|TaiWan|Taiwan)).*$

  - name: æ–°åŠ å¡-æ•…è½¬
    type: fallback
    interval: 300
    lazy: false
    proxies:
      - æ–°åŠ å¡-æ‰‹åŠ¨
      - æ–°åŠ å¡-è‡ªåŠ¨

  - name: æ–°åŠ å¡-æ‰‹åŠ¨
    type: select
    include-all: true
    filter: (?=.*(å¹¿æ–°|æ–°åŠ å¡|SG|å¡|ç‹®åŸ|ğŸ‡¸ğŸ‡¬|Singapore)).*$

  - name: æ–°åŠ å¡-è‡ªåŠ¨
    type: url-test
    include-all: true
    tolerance: 50
    interval: 600
    filter: (?=.*(å¹¿æ–°|æ–°åŠ å¡|SG|å¡|ç‹®åŸ|ğŸ‡¸ğŸ‡¬|Singapore)).*$

  - name: ç¾å›½-æ•…è½¬
    type: fallback
    interval: 300
    lazy: false
    proxies:
      - ç¾å›½-æ‰‹åŠ¨
      - ç¾å›½-è‡ªåŠ¨

  - name: ç¾å›½-æ‰‹åŠ¨
    type: select
    include-all: true
    filter: (?=.*(å¹¿ç¾|US|ç¾å›½|çº½çº¦|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’|å‡¤å‡°åŸ|è´¹åˆ©è’™|æ´›æ‰|åœ£ä½•å¡|åœ£å…‹æ‹‰|è¥¿é›…|èŠåŠ |ğŸ‡ºğŸ‡¸|United States)).*$

  - name: ç¾å›½-è‡ªåŠ¨
    type: url-test
    include-all: true
    tolerance: 50
    interval: 600
    filter: (?=.*(å¹¿ç¾|US|ç¾å›½|çº½çº¦|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’|å‡¤å‡°åŸ|è´¹åˆ©è’™|æ´›æ‰|åœ£ä½•å¡|åœ£å…‹æ‹‰|è¥¿é›…|èŠåŠ |ğŸ‡ºğŸ‡¸|United States)).*$

  # - name: TikTok-è‡ªåŠ¨
  #   type: url-test
  #   include-all: true
  #   tolerance: 50
  #   url: https://www.tiktok.com/
  #   filter: ^((?!(ç›´è¿|æ‹’ç»)).)*$
  #   interval: 600
  #   lazy: true

# =========================
# è§„åˆ™
# =========================
rules:
  # ç›´è¿åŸŸå
  - DOMAIN,glacier.top,DIRECT
  # ç§æœ‰ç½‘ç»œæœ€é«˜ä¼˜å…ˆ
  - RULE-SET,private,ğŸ  ç§æœ‰ç½‘ç»œ,no-resolve
  - RULE-SET,test_domain,ğŸ§¬ TEST
  - RULE-SET,tiktok,ğŸ¬ TikTok # TikTok åŸŸå ä¼˜å…ˆèµ°ä»£ç†
  - RULE-SET,cn,ğŸ”’ å›½å†…æœåŠ¡,no-resolve # ä¸­å›½ IP ä¼˜å…ˆç›´è¿
  - RULE-SET,geolocation-cn,ğŸ”’ å›½å†…æœåŠ¡ # ä¸­å›½åŸŸåç›´è¿

  # # WebRTC é˜²æ³„éœ² å¯èƒ½å¯¼è‡´å›½å†…è§†é¢‘é€šè¯ç»•ä»£ç†
  # - DST-PORT,3478,ğŸ¬ TikTok
  # - DST-PORT,5349,ğŸ¬ TikTok
  # - DOMAIN-KEYWORD,stun,ğŸ¬ TikTok
  # - DOMAIN-SUFFIX,webrtc.org,ğŸ¬ TikTok

  - RULE-SET,category-ai-!cn,ğŸ’¬ AI æœåŠ¡
  - RULE-SET,netflix,ğŸ¬ æµåª’ä½“
  - RULE-SET,hulu,ğŸ¬ æµåª’ä½“
  - RULE-SET,disney,ğŸ¬ æµåª’ä½“
  - RULE-SET,hbo,ğŸ¬ æµåª’ä½“
  - RULE-SET,amazon,ğŸ¬ æµåª’ä½“
  - RULE-SET,bahamut,ğŸ¬ æµåª’ä½“
  - RULE-SET,youtube,ğŸ¬ æµåª’ä½“
  - RULE-SET,steam,ğŸ® æ¸¸æˆå¹³å°
  - RULE-SET,epicgames,ğŸ® æ¸¸æˆå¹³å°
  - RULE-SET,ea,ğŸ® æ¸¸æˆå¹³å°
  - RULE-SET,ubisoft,ğŸ® æ¸¸æˆå¹³å°
  - RULE-SET,blizzard,ğŸ® æ¸¸æˆå¹³å°
  - RULE-SET,geolocation-!cn,ğŸŒ éä¸­å›½ # éä¸­å›½åŸŸåä»£ç†
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼ # æœ€ç»ˆå…œåº•

# =========================
# Geo æ•°æ®è·å–
# =========================
geodata-mode: true
geo-auto-update: true
geodata-loader: standard
geo-update-interval: 24
geox-url:
  geoip: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat
  geosite: >-
    https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat
  mmdb: >-
    https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb
  asn: >-
    https://github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb

# =========================
# è§„åˆ™é›†è·å–
# =========================
rule-providers:
  test_domain:
    type: http
    behavior: classical
    format: text
    url: >-
      https://gh-proxy.com/raw.githubusercontent.com/liandu2024/clash/refs/heads/main/list/Check.list
    path: ./ruleset/Check.list
    interval: 86400
  category-ai-!cn:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-ai-!cn.mrs
    path: ./ruleset/category-ai-!cn.mrs
    interval: 86400
  youtube:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/youtube.mrs
    path: ./ruleset/youtube.mrs
    interval: 86400
  google:
    type: http
    format: mrs
    behavior: ipcidr
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/google.mrs
    path: ./ruleset/google.mrs
    interval: 86400
  geolocation-cn:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/geolocation-cn.mrs
    path: ./ruleset/geolocation-cn.mrs
    interval: 86400
  cn:
    type: http
    format: mrs
    behavior: ipcidr
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/cn.mrs
    path: ./ruleset/cn.mrs
    interval: 86400
  netflix:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/netflix.mrs
    path: ./ruleset/netflix.mrs
    interval: 86400
  hulu:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/hulu.mrs
    path: ./ruleset/hulu.mrs
    interval: 86400
  disney:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/disney.mrs
    path: ./ruleset/disney.mrs
    interval: 86400
  hbo:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/hbo.mrs
    path: ./ruleset/hbo.mrs
    interval: 86400
  amazon:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/amazon.mrs
    path: ./ruleset/amazon.mrs
    interval: 86400
  bahamut:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/bahamut.mrs
    path: ./ruleset/bahamut.mrs
    interval: 86400
  steam:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/steam.mrs
    path: ./ruleset/steam.mrs
    interval: 86400
  epicgames:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/epicgames.mrs
    path: ./ruleset/epicgames.mrs
    interval: 86400
  ea:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/ea.mrs
    path: ./ruleset/ea.mrs
    interval: 86400
  ubisoft:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/ubisoft.mrs
    path: ./ruleset/ubisoft.mrs
    interval: 86400
  blizzard:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/blizzard.mrs
    path: ./ruleset/blizzard.mrs
    interval: 86400
  geolocation-!cn:
    type: http
    format: mrs
    behavior: domain
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/geolocation-!cn.mrs
    path: ./ruleset/geolocation-!cn.mrs
    interval: 86400
  private:
    type: http
    format: mrs
    behavior: ipcidr
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/private.mrs
    path: ./ruleset/private.mrs
    interval: 86400
  tiktok:
    type: http
    format: mrs
    behavior: domain
    url: https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/tiktok.mrs
    path: ./ruleset/tiktok.mrs
    interval: 86400
  telegram:
    type: http
    format: mrs
    behavior: ipcidr
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/telegram.mrs
    path: ./ruleset/telegram.mrs
    interval: 86400
