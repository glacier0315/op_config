# =========================
# ä»£ç†è®¢é˜…
# =========================
ProxyProvidersSet: &ProxyProvidersSet
  type: http
  proxy: DIRECT
  interval: 86400
  health-check:
    enable: true
    url: "https://www.gstatic.com/generate_204"
    interval: 600
  override:
    udp: true
    additional-prefix: ""
    skip-cert-verify: true
  exclude-filter: "(?i)(è¿‡æœŸæ—¶é—´)|(å‰©ä½™æµé‡)|(TGç¾¤)|(å®˜ç½‘)"

proxy-providers:
  # æœºåœºåç§°
  sub1:
    # æœºåœºè®¢é˜…åœ°å€
    url: https://your-subscribe.example.com/sub1?token=xxxxx
    path: "./proxy_provider/sub1.yaml"
    <<: *ProxyProvidersSet
    override:
      additional-prefix: "sub1-"
    # è®¢é˜…èŠ‚ç‚¹çš„ User-Agent
    header:
      User-Agent:
        - passwall
  sub2:
    # æœºåœºè®¢é˜…åœ°å€
    url: https://your-subscribe.example.com/sub2?token=xxxxx
    path: "./proxy_provider/sub2.yaml"
    <<: *ProxyProvidersSet
    override:
      additional-prefix: "sub2-"

# =========================
# åŸºç¡€é…ç½®
# =========================
mixed-port: 7890
allow-lan: true
mode: rule
ipv6: false
log-level: warning
tcp-concurrent: true

find-process-mode: strict

# =========================
# å¤–éƒ¨æ§åˆ¶å™¨é…ç½®
# =========================
external-controller: 0.0.0.0:9090
secret: "1234456"

# =========================
# é…ç½®æ–‡ä»¶ç®¡ç†
# =========================
profile:
  store-selected: true
  store-fake-ip: true

proxies:
  # é“¾å¼ä»£ç†
  # - name: ğŸš€ é“¾å¼å‡ºå£
  #   type: socks5
  #   server:
  #   port:
  #   username:
  #   password:
  #   dialer-proxy: ğŸš€ é¦™æ¸¯

# =========================
# ä»£ç†ç»„é…ç½®
# =========================

### ç­–ç•¥ç»„åŸºç¡€é…ç½®
Select: &Select
  type: select
  url: "https://www.gstatic.com/generate_204"
  disable-udp: false
  hidden: false
  include-all: true

UrlTest: &UrlTest
  type: url-test
  url: "https://www.gstatic.com/generate_204"
  interval: 180
  lazy: true
  tolerance: 50
  timeout: 2000
  disable-udp: false
  max-failed-times: 3
  hidden: false
  include-all: true

FallBack: &FallBack
  type: fallback
  url: "https://www.gstatic.com/generate_204"
  interval: 180
  lazy: true
  timeout: 2000
  disable-udp: false
  max-failed-times: 3
  hidden: false
  include-all: true

LoadBalance: &LoadBalance
  type: load-balance
  url: "https://www.gstatic.com/generate_204"
  interval: 180
  lazy: true
  disable-udp: false
  strategy: consistent-hashing
  timeout: 2000
  max-failed-times: 3
  hidden: false
  include-all: true

### ä»£ç†åˆ—è¡¨é”šç‚¹
Base-proxies: &Base-proxies
  - âš¡ è‡ªåŠ¨é€‰æ‹©
  - ğŸ–ï¸ æ‰‹åŠ¨åˆ‡æ¢
  - ğŸš€ é¦™æ¸¯
  - ğŸš€ å°æ¹¾
  - ğŸš€ æ—¥æœ¬
  - ğŸš€ æ–°åŠ å¡
  - ğŸš€ ç¾å›½
  - ğŸš€ å…¶ä»–
  # - ğŸš€ é“¾å¼å‡ºå£
  - DIRECT
  - REJECT

### æ‰©å±•ä»£ç†åˆ—è¡¨ï¼ˆå«èŠ‚ç‚¹é€‰æ‹©ï¼‰
Proxies-select: &Proxies-select
  - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - âš¡ è‡ªåŠ¨é€‰æ‹©
  - ğŸ–ï¸ æ‰‹åŠ¨åˆ‡æ¢
  - ğŸš€ é¦™æ¸¯
  - ğŸš€ å°æ¹¾
  - ğŸš€ æ—¥æœ¬
  - ğŸš€ æ–°åŠ å¡
  - ğŸš€ ç¾å›½
  - ğŸš€ å…¶ä»–
  # - ğŸš€ é“¾å¼å‡ºå£
  - DIRECT
  - REJECT

### é€šç”¨åŠŸèƒ½ç»„é…ç½®
Function-group-config: &Function-group-config
  type: select
  proxies: *Proxies-select

proxy-groups:
  # èŠ‚ç‚¹é€‰æ‹©ç»„
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    proxies: *Base-proxies

  # è‡ªåŠ¨é€‰æ‹©ç»„
  - name: âš¡ è‡ªåŠ¨é€‰æ‹©
    <<: *UrlTest
    hidden: false
    filter: ^((?!(ç›´è¿|DIRECT|æ‹’ç»|REJECT)).)*$

  # æ‰‹åŠ¨åˆ‡æ¢ç»„
  - name: ğŸ–ï¸ æ‰‹åŠ¨åˆ‡æ¢
    <<: *Select
    filter: ^((?!(ç›´è¿|DIRECT|æ‹’ç»|REJECT)).)*$

  # åŠŸèƒ½ç­–ç•¥ç»„
  - <<: *Function-group-config
    name: ğŸ›‘ å¹¿å‘Šæ‹¦æˆª

  - <<: *Function-group-config
    name: ğŸ  ç§æœ‰ç½‘ç»œ
  - <<: *Function-group-config
    name: ğŸ¯ å…¨çƒç›´è¿

  - <<: *Function-group-config
    name: ğŸŒ å…¨çƒä»£ç†
  - <<: *Function-group-config
    name: ğŸŸ æ¼ç½‘ä¹‹é±¼

  # åœ°åŒºèŠ‚ç‚¹ç»„ - é¦™æ¸¯
  - name: ğŸš€ é¦™æ¸¯
    <<: *LoadBalance
    filter: "(?=.*(å¹¿æ¸¯|é¦™æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°|HongKong)).*$"

  # åœ°åŒºèŠ‚ç‚¹ç»„ - æ–°åŠ å¡
  - name: ğŸš€ æ–°åŠ å¡
    <<: *LoadBalance
    filter: "(?=.*(å¹¿æ–°|æ–°åŠ å¡|SG|å¡|ç‹®åŸ|ğŸ‡¸ğŸ‡¬|Singapore)).*$"
    exclude-filter: "(?=.*(æ–°åŠ å¡1|VIP1|vip1)).*$"

  # åœ°åŒºèŠ‚ç‚¹ç»„ - å°æ¹¾
  - name: ğŸš€ å°æ¹¾
    <<: *FallBack
    filter: "(?=.*(å¹¿å°|å°æ¹¾|å°ç£|TW|Tai Wan|ğŸ‡¹ğŸ‡¼|ğŸ‡¨ğŸ‡³|TaiWan|Taiwan)).*$"
    exclude-filter: "(?=.*(å°æ¹¾3)).*$"

  # åœ°åŒºèŠ‚ç‚¹ç»„ - æ—¥æœ¬
  - name: ğŸš€ æ—¥æœ¬
    <<: *FallBack
    filter: "(?=.*(å¹¿æ—¥|æ—¥æœ¬|JP|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|ğŸ‡¯ğŸ‡µ|Japan)).*$"

  # åœ°åŒºèŠ‚ç‚¹ç»„ - ç¾å›½
  - name: ğŸš€ ç¾å›½
    <<: *FallBack
    filter: "(?=.*(å¹¿ç¾|US|ç¾å›½|çº½çº¦|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’|å‡¤å‡°åŸ|è´¹åˆ©è’™|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|ğŸ‡ºğŸ‡¸|United States)).*$"

  # åœ°åŒºèŠ‚ç‚¹ç»„ - å…¶ä»–
  - name: ğŸš€ å…¶ä»–
    type: select
    include-all: true
    filter: "^((?!(ç›´è¿|DIRECT|æ‹’ç»|REJECT|é“¾å¼|å¹¿æ¸¯|é¦™æ¸¯|HK|Hong Kong|ğŸ‡­ğŸ‡°|HongKong|å¹¿å°|å°æ¹¾|å°ç£|TW|Tai Wan|ğŸ‡¹ğŸ‡¼|ğŸ‡¨ğŸ‡³|TaiWan|Taiwan|å¹¿æ—¥|æ—¥æœ¬|JP|å·æ—¥|ä¸œäº¬|å¤§é˜ª|æ³‰æ—¥|åŸ¼ç‰|æ²ªæ—¥|æ·±æ—¥|ğŸ‡¯ğŸ‡µ|Japan|å¹¿æ–°|æ–°åŠ å¡|SG|å¡|ç‹®åŸ|ğŸ‡¸ğŸ‡¬|Singapore|å¹¿ç¾|US|ç¾å›½|çº½çº¦|æ³¢ç‰¹å…°|è¾¾æ‹‰æ–¯|ä¿„å‹’|å‡¤å‡°åŸ|è´¹åˆ©è’™|æ´›æ‰çŸ¶|åœ£ä½•å¡|åœ£å…‹æ‹‰æ‹‰|è¥¿é›…å›¾|èŠåŠ å“¥|ğŸ‡ºğŸ‡¸|United States)).)*$"

# =========================
# Geo æ•°æ®è·å–
# =========================
geodata-mode: true
geo-auto-update: true
geodata-loader: standard
geo-update-interval: 24
geox-url:
  geoip: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat
  geosite: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat
  mmdb: https://testingcf.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/country.mmdb
  asn: https://testingcf.jsdelivr.net/gh/xishang0128/geoip@release/GeoLite2-ASN.mmdb

# =========================
# è§„åˆ™é›†è·å–
# =========================
# å®šä¹‰é€šç”¨é”šç‚¹
BaseHTTP: &BaseHTTP
  type: http
  interval: 86400

DomainMRS: &DomainMRS
  <<: *BaseHTTP
  format: mrs
  behavior: domain

IPCIDRMRS: &IPCIDRMRS
  <<: *BaseHTTP
  format: mrs
  behavior: ipcidr

FakeIPFilter: &FakeIPFilter
  <<: *BaseHTTP
  format: text
  behavior: domain

# æ­£å¼è§„åˆ™
rule-providers:
  fake_ip_filter:
    <<: *FakeIPFilter
    url: >-
      https://gh-proxy.com/https://raw.githubusercontent.com/DustinWin/ShellCrash/refs/heads/dev/public/fake_ip_filter.list
    path: ./rule_provider/fake_ip_filter.list

  category-ads-all:
    <<: *DomainMRS
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/category-ads-all.mrs
    path: ./rule_provider/category-ads-all.mrs

  geolocation-cn:
    <<: *DomainMRS
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/geolocation-cn.mrs
    path: ./rule_provider/geolocation-cn.mrs

  cn-domain:
    <<: *DomainMRS
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/cn.mrs
    path: ./rule_provider/cn-domain.mrs

  geolocation-!cn:
    <<: *DomainMRS
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geosite/geolocation-!cn.mrs
    path: ./rule_provider/geolocation-!cn.mrs

  private:
    <<: *IPCIDRMRS
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/private.mrs
    path: ./rule_provider/private.mrs

  cn:
    <<: *IPCIDRMRS
    url: >-
      https://gh-proxy.com/https://github.com/MetaCubeX/meta-rules-dat/raw/refs/heads/meta/geo/geoip/cn.mrs
    path: ./rule_provider/cn.mrs

# =========================
# è§„åˆ™
# =========================
rules:
  - DOMAIN-SUFFIX,glacier.top,DIRECT
  - DOMAIN-SUFFIX,glacier.de5.net,DIRECT
  - RULE-SET,category-ads-all,ğŸ›‘ å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,private,ğŸ  ç§æœ‰ç½‘ç»œ,no-resolve
  - RULE-SET,geolocation-cn,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,cn-domain,ğŸ¯ å…¨çƒç›´è¿
  - RULE-SET,cn,ğŸ¯ å…¨çƒç›´è¿,no-resolve

  - RULE-SET,geolocation-!cn,ğŸŒ å…¨çƒä»£ç†,no-resolve
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼

# =========================
# TUN å¼ºåˆ¶æ¥ç®¡æ¨¡å¼
# =========================
tun:
  enable: false
  stack: mixed
  auto-route: true
  auto-detect-interface: true
  auto-redirect: true
  strict-route: true
  dns-hijack:
    - any:53

# =========================
# DNS é…ç½®
# =========================
dns:
  enable: true
  prefer-h3: false
  ipv6: false
  use-hosts: true
  use-system-hosts: false
  respect-rules: true

  cache-algorithm: arc
  cache-max-size: 4096

  listen: 0.0.0.0:7874
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter-mode: blacklist
  fake-ip-ttl: 300

  fake-ip-filter:
    - rule-set:fake_ip_filter
    # è‡ªå®šä¹‰åŸŸå
    - "+.glacier.top"
    - "+.glacier.de5.net"
    # æœºåœº
    - "*.ali66mysql.com"

  # ä¿è¯ç›´è¿åŸŸååªèµ° direct-nameserver / nameserverï¼Œä¸è¢« fallback å¹²æ‰°
  direct-nameserver-follow-policy: false

  # ä»…ç”¨äºè§£æ DNS æœåŠ¡å™¨åŸŸåï¼ˆé˜²æ­»å¾ªç¯ï¼‰
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
    - tls://1.1.1.1
    - tls://8.8.8.8

  # å…¨å±€é»˜è®¤åŠ å¯† DNS
  nameserver:
    - https://dns.alidns.com/dns-query#h3=true
    - https://doh.pub/dns-query

  # ä»£ç†èŠ‚ç‚¹ä¸“å± DNSï¼ˆæ ¸å¿ƒï¼šé˜²è§£ææ­»å¾ªç¯ï¼‰
  proxy-server-nameserver:
    - https://dns.alidns.com/dns-query#h3=true
    - https://doh.pub/dns-query

  # fallback ä»…ä½œä¸ºä¿é™©
  fallback:
    - https://dns.cloudflare.com/dns-query
    - https://dns.google/dns-query

  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
      - 0.0.0.0/32
    domain:
      - "+.github.com"
    geosite:
      - gfw

# =========================
# ç«¯å£ç›‘å¬é…ç½®ï¼ˆå¯é€‰ï¼‰
# ä¾‹å¦‚ï¼š
#  - Steam å¼ºåˆ¶ç¾åŒº
#  - TikTok å¼ºåˆ¶å°æ¹¾
#  - ChatGPT å¼ºåˆ¶ç¾å›½
# =========================
# listeners:
#   - name: mixed0
#     type: mixed
#     listen: 0.0.0.0
#     port: 42000
#     proxy: ğŸš€ æ–°åŠ å¡
#     udp: true
#   - name: mixed1
#     type: mixed
#     listen: 0.0.0.0
#     port: 42001
#     proxy: ğŸš€ é¦™æ¸¯
#     udp: true
#   - name: mixed2
#     type: mixed
#     listen: 0.0.0.0
#     port: 42002
#     proxy: ğŸš€ å°æ¹¾
#     udp: true
#   - name: mixed3
#     type: mixed
#     listen: 0.0.0.0
#     port: 42003
#     proxy: ğŸš€ é“¾å¼å‡ºå£
#     udp: true
#   - name: mixed4
#     type: mixed
#     listen: 0.0.0.0
#     port: 42004
#     proxy: DIRECT
#     udp: true
